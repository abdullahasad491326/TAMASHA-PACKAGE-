<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced OTP Sender</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f2f5; display:flex; justify-content:center; align-items:center; height:100vh; }
.container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); width:350px; }
h2 { text-align:center; margin-bottom:20px; }
input, button { width:100%; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
#response { margin-top:15px; padding:10px; background:#e8f5e9; border-radius:5px; font-size:14px; max-height:300px; overflow-y:auto; }
.copy-btn { margin-left:5px; padding:2px 5px; font-size:12px; cursor:pointer; }
</style>
</head>
<body>

<div class="container">
  <h2>Advanced OTP Sender</h2>
  <input type="text" id="mobile" placeholder="Enter Mobile Number e.g. 03XXXXXXXXX">
  <input type="number" id="otpCount" placeholder="Number of OTPs (default 1)" value="1">
  <button onclick="sendOTP()">Send OTP(s)</button>
  <div id="response"></div>
</div>

<script>
async function sendOTP() {
    const mobile = document.getElementById('mobile').value.trim();
    const count = parseInt(document.getElementById('otpCount').value) || 1;
    const responseDiv = document.getElementById('response');
    responseDiv.innerHTML = '';

    // Validate 03xxxxxxxxx format
    if(!mobile.match(/^03\d{9}$/)) {
        responseDiv.innerHTML = "<span style='color:red;'>Invalid mobile number format!</span>";
        return;
    }

    responseDiv.innerHTML = "Sending OTP(s)...<br>";

    try {
        const res = await fetch("/send-otp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ mobile_number: mobile, count })
        });

        const data = await res.json();

        data.results.forEach(r => {
            if(r.response) {
                const otp = r.response.data?.otp || "N/A";
                responseDiv.innerHTML += `<b>Attempt ${r.attempt}:</b> ${r.response.message}<br>OTP: ${otp} <button class="copy-btn" onclick="copyOTP('${otp}')">Copy OTP</button><br><br>`;
            } else {
                responseDiv.innerHTML += `<b>Attempt ${r.attempt}:</b> Error: ${r.error}<br><br>`;
            }
        });

    } catch(err) {
        responseDiv.innerHTML += `<b>Server Error:</b> ${err.message}`;
    }
}

function copyOTP(otp) {
    navigator.clipboard.writeText(otp);
    alert("OTP copied: " + otp);
}
</script>

</body>
</html>
